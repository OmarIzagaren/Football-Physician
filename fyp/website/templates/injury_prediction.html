{% extends 'base.html' %}

{% block content %}

<script>
    var gameCount = 0;

    function addGame(current) {
        var gamesContainer = document.getElementById('gamesContainer');
    
        // Create a new div to hold the input and remove button
        var gameDiv = document.createElement('div');
        gameDiv.className = 'mb-3';
    
        // Create a new input element for the new game
        var newInput = document.createElement('input');
        newInput.type = 'number';
        newInput.className = 'form-control d-inline mr-2';  // Bootstrap styling
        newInput.name = 'games[]';  // Use array syntax
        newInput.placeholder = 'Enter minutes played for this game';
        newInput.required = true;
        newInput.min = 0;
        newInput.max = 120;  // Set maximum input value
        console.log(current)
        if (current != null){
            newInput.value = current
        }
    
        // Create a new remove button
        var removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'btn btn-danger';
        removeButton.textContent = 'Remove';
        removeButton.onclick = function() {
            gamesContainer.removeChild(gameDiv);
        };
    
        // Append the new input element and remove button to the game div
        gameDiv.appendChild(newInput);
        gameDiv.appendChild(removeButton);
    
        // Append the game div to the games container
        gamesContainer.appendChild(gameDiv);
    }

</script>

<div>
    <h1>Injury Prediction</h1>
    <p>First select a player to predict their risk of an <strong>ACL injury</strong>, once a player is selected choose a predictive
        model to use. Finally, you need to add the games they have played <strong>within the last month</strong>, once this is done you can run the prediction.
    </p>
    
    <form method="POST">
        {% csrf_token %}
        <h2>Select Player</h2>
        {% if players %}
        <div class="form-group">
            <select class="form-control" id="playersDropdown" name="player" required>
                <option value="">Select a player...</option>
                {% for player in players %}
                    {% if player.id|stringformat:"s" == player_id %}
                    <option value="{{ player.id }}" selected>{{ player }}</option>
                    {% else %}
                    <option value="{{ player.id }}">{{ player }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <br/>
        <h2>Select Model</h2>
        <div id="radios">
            <input type="radio" class="btn-check" name="model" id="option1" value="svr_rbf" checked>
            <label class="btn btn-outline-secondary" for="option1">SVR RBF</label>

            <input type="radio" class="btn-check" name="model" id="option2" value="svc_rbf" {% if model == 'svc_rbf' %}checked{% endif %}>
            <label class="btn btn-outline-secondary" for="option2">SVC RBF</label>

            <input type="radio" class="btn-check" name="model" id="option3" value="rfr" {% if model == 'rfr' %}checked{% endif %}>
            <label class="btn btn-outline-secondary" for="option3">RFR</label>
            
        </div>
        <br/>

        <div class="card" style="width: 22rem;">
            <div class="card-body">
            <div id="modelInfoContainer">
            {% if model %}
            {% else %}
              <h5 class="card-title">SVR RBF Model</h5>
              <h6 class="card-subtitle mb-2 text-muted">Support Vector Regression with Radial Basis Function kernel</h6>
              <p class="card-text"> The most well-rounded model for predicting the risk of injury, considers all factors when making a prediction.</p>
            {% endif %}
            </div>
            </div>
          </div>

        <br/>
        <h2>Games in last month</h2>
        <div id="gamesContainer" class="mb-3">
        {% if games %}
            {% for game in games %}
                <script>addGame({{ game }});</script>
            {% endfor %}
        {% endif %}
        </div>

        <button type="button" class="btn btn-primary" onclick="addGame(null)">Add Game</button>
        <button type="submit" class="btn btn-outline-success">Submit</button>
        {% if injury_risk_prediction %}
        <br/>
        <br/>
        <button type="submit" class="btn btn-primary" name="generate_pdf" value="yes">Generate PDF Report</button>
        {% else %}
        {% endif %}
    </form>
</div>
<br/>

{% if injury_risk_prediction %}
<div class="accordion" id="prediction">
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          <strong>Prediction</strong>
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#prediction">
        <div class="accordion-body">
          Based on the this players information and the details provided they have a <strong>{{injury_risk_prediction}}</strong> of getting injured.
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            <strong>Exercises to avoid</strong>
        </button>
      </h2>
      <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#prediction">
        <div class="accordion-body">
          {{ paragraphs.0 }}
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
            <strong>Exercises to do</strong>
        </button>
      </h2>
      <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#prediction">
        <div class="accordion-body">
            {{ paragraphs.1 }}
        </div>
      </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
              <strong>Advice</strong>
          </button>
        </h2>
        <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#prediction">
          <div class="accordion-body">
            {{ paragraphs.2 }}
          </div>
        </div>
      </div>
  </div>
  </div>

  
<br/>

{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const radioContainer = document.getElementById('radios');
        const checkedRadioButton = document.querySelector('input[type="radio"]:checked');
        var displayModelInfo = document.getElementById('modelInfoContainer');

        function updateModelInfo() {
            const checkedRadioButton = document.querySelector('input[type="radio"]:checked');
    
            if (checkedRadioButton.id == "option1") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVR RBF Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Regression with Radial Basis Function kernel</h6>
                <p class="card-text">The most well-rounded model for predicting the risk of injury, considers all factors when making a prediction.</p>
                `;
            }
            else if (checkedRadioButton.id == "option2") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVC RBF Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Classifier with Radial Basis Function kernel</h6>
                <p class="card-text">This model's behavior varies based on the number of injuries and current injury status. 
                    Dependant on those factors, minutes played may have no effect or a significant effect on predictions.</p>
                `;
            }
            else{
                displayModelInfo.innerHTML = `
                <h5 class="card-title">RFR Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Random Forest Regressor</h6>
                <p class="card-text">This model's behavior varies based on the number of injuries and current injury status. 
                    Dependant on those factors, minutes played may have no effect or a significant effect on predictions.</p>
                `;
            }
        }
        
        updateModelInfo();

        radioContainer.addEventListener('change', function(event) {
            const checkedRadioButton = document.querySelector('input[type="radio"]:checked');

            if (checkedRadioButton.id == "option1") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVR RBF Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Regression with Radial Basis Function kernel</h6>
                <p class="card-text">The most well-rounded model for predicting the risk of injury, considers all factors when making a prediction.</p>
                `;
            }
            else if (checkedRadioButton.id == "option2") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVC RBF Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Classifier with Radial Basis Function kernel</h6>
                <p class="card-text">This model's behavior varies based on the number of injuries and current injury status. 
                    Dependant on those factors, minutes played may have no effect or a significant effect on predictions.</p>
                `;
            }
            else{
                displayModelInfo.innerHTML = `
                <h5 class="card-title">RFR Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Random Forest Regressor</h6>
                <p class="card-text">This model's behavior varies based on the number of injuries and current injury status. 
                    Dependant on those factors, minutes played may have no effect or a significant effect on predictions.</p>
                `;
            }
            
        });

    });

    window.onload = function() {
        if (document.getElementById('prediction')) {
            document.getElementById('prediction').scrollIntoView({ behavior: 'smooth' });
        }
      };
</script>


{% endblock %}