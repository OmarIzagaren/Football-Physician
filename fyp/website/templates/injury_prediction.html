{% extends 'base.html' %}

{% block content %}

<script>
    var gameCount = 0;

    function addGame(current) {
        var gamesContainer = document.getElementById('gamesContainer');
    
        // Create a new div to hold the input and remove button
        var gameDiv = document.createElement('div');
        gameDiv.className = 'mb-3';
    
        // Create a new input element for the new game
        var newInput = document.createElement('input');
        newInput.type = 'number';
        newInput.className = 'form-control d-inline mr-2';  // Bootstrap styling
        newInput.name = 'games[]';  // Use array syntax
        newInput.placeholder = 'Enter minutes played for this game';
        newInput.required = true;
        newInput.min = 0;
        newInput.max = 120;  // Set maximum input value
        console.log(current)
        if (current != null){
            newInput.value = current
        }
    
        // Create a new remove button
        var removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'btn btn-danger';
        removeButton.textContent = 'Remove';
        removeButton.onclick = function() {
            gamesContainer.removeChild(gameDiv);
        };
    
        // Append the new input element and remove button to the game div
        gameDiv.appendChild(newInput);
        gameDiv.appendChild(removeButton);
    
        // Append the game div to the games container
        gamesContainer.appendChild(gameDiv);
    }

</script>

<div class="container mt-5">
    <h1>Injury Prediction</h1>
    <p>For this section you will need to firstly select a player to predict their likelihood of a knee injury. Once a player is selected
        you need to input the games they have played <strong>within the last month</strong>, once this is done you can run the prediction.
    </p>
    
    <form method="POST">
        {% csrf_token %}
        <h2>Select Player</h2>
        {% if players %}
        <div class="form-group">
            <select class="form-control" id="playersDropdown" name="player" required>
                <option value="">Select a player...</option>
                {% for player in players %}
                    {% if player.id|stringformat:"s" == player_id %}
                    <option value="{{ player.id }}" selected>{{ player }}</option>
                    {% else %}
                    <option value="{{ player.id }}">{{ player }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <br/>
        <h2>Select Model</h2>
        <div id="radios">
            <input type="radio" class="btn-check" name="model" id="option1" value="svr_rbf" checked>
            <label class="btn btn-outline-secondary" for="option1">SVR RBF</label>

            <input type="radio" class="btn-check" name="model" id="option2" value="svr_poly" {% if model == 'svr_poly' %}checked{% endif %}>
            <label class="btn btn-outline-secondary" for="option2">SVR Poly</label>

            <input type="radio" class="btn-check" name="model" id="option3" value="svc_rbf" {% if model == 'svc_rbf' %}checked{% endif %}>
            <label class="btn btn-outline-secondary" for="option3">SVC RBF</label>

            <input type="radio" class="btn-check" name="model" id="option4" value="svc_poly" {% if model == 'svc_poly' %}checked{% endif %}>
            <label class="btn btn-outline-secondary" for="option4">SVC Poly</label>
            
        </div>
        <br/>

        <div class="card" style="width: 22rem;">
            <div class="card-body">
            <div id="modelInfoContainer">
            {% if model %}
            {% else %}
              <h5 class="card-title">SVR RBF Model</h5>
              <h6 class="card-subtitle mb-2 text-muted">Support Vector Regression with Radial Basis Function kernel</h6>
              <p class="card-text"> The most well-rounded model for predicting the risk of injury, considers all factors when making a prediction.</p>
            {% endif %}
            </div>
            </div>
          </div>

        <br/>
        <h2>Games in last month</h2>
        <div id="gamesContainer" class="mb-3">
        {% if games %}
            {% for game in games %}
                <script>addGame({{ game }});</script>
            {% endfor %}
        {% endif %}
        </div>

        <button type="button" class="btn btn-primary" onclick="addGame(null)">Add Game</button>
        <button type="submit" class="btn btn-success">Submit</button>
    </form>
</div>
<br/>

{% if injury_risk_prediction %}
<br/>
    <div class="card" id="prediction">
        <div class="card-body">
            {{ injury_risk_prediction }}
        </div>
      </div>
<br/>

{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const radioContainer = document.getElementById('radios');
        const checkedRadioButton = document.querySelector('input[type="radio"]:checked');
        var displayModelInfo = document.getElementById('modelInfoContainer');

        function updateModelInfo() {
            const checkedRadioButton = document.querySelector('input[type="radio"]:checked');
    
            if (checkedRadioButton.id == "option1") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVR RBF Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Regression with Radial Basis Function kernel</h6>
                <p class="card-text">The most well-rounded model for predicting the risk of injury, considers all factors when making a prediction.</p>
                `;
            }
            else if (checkedRadioButton.id == "option2") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVR Poly Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Regression with Polynomial Function kernel</h6>
                <p class="card-text">This model shows a slight bias towards minutes played and is particularly 
                    effective for predicting injury likelihood among currently injured players.</p>
                `;
            }
            else if (checkedRadioButton.id == "option3") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVC RBF Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Classifier with Radial Basis Function kernel</h6>
                <p class="card-text">This model's behavior varies based on the number of injuries and current injury status. 
                    Dependant on those factors, minutes played may have no effect or a significant effect on predictions.</p>
                `;
            }
            else{
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVC Poly Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Classifier with Polynomial Function kernel</h6>
                <p class="card-text">This model's behavior varies based on the number of injuries and current injury status. 
                    Dependant on those factors, minutes played may have no effect or a significant effect on predictions.</p>
                `;
            }
        }
        
        updateModelInfo();

        radioContainer.addEventListener('change', function(event) {
            const checkedRadioButton = document.querySelector('input[type="radio"]:checked');

            if (checkedRadioButton.id == "option1") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVR RBF Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Regression with Radial Basis Function kernel</h6>
                <p class="card-text">The most well-rounded model for predicting the risk of injury, considers all factors when making a prediction.</p>
                `;
            }
            else if (checkedRadioButton.id == "option2") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVR Poly Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Regression with Polynomial Function kernel</h6>
                <p class="card-text">This model shows a slight bias towards minutes played and is particularly 
                    effective for predicting injury likelihood among currently injured players.</p>
                `;
            }
            else if (checkedRadioButton.id == "option3") {
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVC RBF Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Classifier with Radial Basis Function kernel</h6>
                <p class="card-text">This model's behavior varies based on the number of injuries and current injury status. 
                    Dependant on those factors, minutes played may have no effect or a significant effect on predictions.</p>
                `;
            }
            else{
                displayModelInfo.innerHTML = `
                <h5 class="card-title">SVC Poly Model</h5>
                <h6 class="card-subtitle mb-2 text-muted">Support Vector Classifier with Polynomial Function kernel</h6>
                <p class="card-text">This model's behavior varies based on the number of injuries and current injury status. 
                    Dependant on those factors, minutes played may have no effect or a significant effect on predictions.</p>
                `;
            }
            
        });

    });

    window.onload = function() {
        if (document.getElementById('prediction')) {
            document.getElementById('prediction').scrollIntoView({ behavior: 'smooth' });
        }
      };
</script>


{% endblock %}